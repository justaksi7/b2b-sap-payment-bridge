<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="2108.4367706499947" height="984.3742010428177"><desc>title%20Happy%20Path%20%E2%80%93%20Partner%20Payment%20Flow%0A%0Aparticipant%20Partner%0Aparticipant%20Gateway%0Aparticipant%20PartnerConfigService%0Aparticipant%20DB%0Aparticipant%20Dispatcher%0Aparticipant%20PubSub%0Aparticipant%20Worker%0Aparticipant%20SAP%0Aparticipant%20WebhookService%0A%0APartner-%3E%3EGateway%3A%20POST%20%2Fv1%2Fpayments%20(Idempotency-Key%20%2B%20Auth)%0AGateway-%3E%3EPartnerConfigService%3A%20validate%20auth%2C%20rate%20limit%2C%20mapping%20rules%0APartnerConfigService--%3E%3EGateway%3A%20OK%20(partner%20config)%0AGateway-%3E%3EDB%3A%20TX%3A%20insert%20payment%20%2B%20insert%20outbox(PaymentCreated)%0AGateway--%3E%3EPartner%3A%20202%20Accepted%20%7Bstatus%3A%20%22QUEUED%22%7D%0A%0ADispatcher-%3E%3EDB%3A%20poll%20outbox%20(PaymentCreated)%0ADispatcher-%3E%3EPubSub%3A%20publish%20PaymentCreated%20event%0A%0APubSub-%3E%3EWorker%3A%20deliver%20PaymentCreated%0AWorker-%3E%3EPartnerConfigService%3A%20fetch%20mapping%20rules%2C%20webhook%20info%0AWorker-%3E%3ESAP%3A%20POST%20payment%20(dedupe%20token%20%3D%20payment_id)%0ASAP--%3E%3EWorker%3A%20200%20OK%0A%0AWorker-%3E%3EDB%3A%20update%20status%3DSETTLED%20%2B%20insert%20outbox(PaymentSettled)%0ADispatcher-%3E%3EDB%3A%20poll%20outbox%20(PaymentSettled)%0ADispatcher-%3E%3EPubSub%3A%20publish%20PaymentSettled%20event%0A%0APubSub-%3E%3EWebhookService%3A%20deliver%20PaymentSettled%0AWebhookService-%3E%3EPartnerConfigService%3A%20fetch%20webhook%20URL%20%2B%20signing%20key%0AWebhookService-%3E%3EPartner%3A%20POST%20webhook%20(signed)%0APartner--%3E%3EWebhookService%3A%20200%20OK%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2108" height="984"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 49.928505787628914 95.73914152281817 L 49.928505787628914 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 399.4445685508451 95.73914152281817 L 399.4445685508451 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 689.9055013091784 95.73914152281817 L 689.9055013091784 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 883.4072536990873 95.73914152281817 L 883.4072536990873 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1121.7207560374986 95.73914152281817 L 1121.7207560374986 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1365.7536645038397 95.73914152281817 L 1365.7536645038397 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1566.5797095668604 95.73914152281817 L 1566.5797095668604 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1905.54460961035 95.73914152281817 L 1905.54460961035 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2027.2699073184203 95.73914152281817 L 2027.2699073184203 984.3742010428177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.167601650000002 51.63409261281818 L 91.68940992525782 51.63409261281818 L 91.68940992525782 95.73914152281817 L 8.167601650000002 95.73914152281817 L 8.167601650000002 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="25.891297230500008" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Partner</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 352.79460343909506 51.63409261281818 L 446.09453366259504 51.63409261281818 L 446.09453366259504 95.73914152281817 L 352.79460343909506 95.73914152281817 L 352.79460343909506 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="370.5182990195951" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Gateway</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 602.5146991002604 51.63409261281818 L 777.2963035180964 51.63409261281818 L 777.2963035180964 95.73914152281817 L 602.5146991002604 95.73914152281817 L 602.5146991002604 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="620.2383946807604" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">PartnerConfigService</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 855.5010248544271 51.63409261281818 L 911.3134825437475 51.63409261281818 L 911.3134825437475 95.73914152281817 L 855.5010248544271 95.73914152281817 L 855.5010248544271 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="873.2247204349271" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">DB</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1068.9612862260417 51.63409261281818 L 1174.4802258489558 51.63409261281818 L 1174.4802258489558 95.73914152281817 L 1068.9612862260417 95.73914152281817 L 1068.9612862260417 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1086.6849818065416" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Dispatcher</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1321.9455115258788 51.63409261281818 L 1409.5618174818007 51.63409261281818 L 1409.5618174818007 95.73914152281817 L 1321.9455115258788 95.73914152281817 L 1321.9455115258788 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1339.6692071063787" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">PubSub</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1525.3699834077472 51.63409261281818 L 1607.7894357259738 51.63409261281818 L 1607.7894357259738 95.73914152281817 L 1525.3699834077472 95.73914152281817 L 1525.3699834077472 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1543.0936789882471" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Worker</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1873.153776883854 51.63409261281818 L 1937.9354423368463 51.63409261281818 L 1937.9354423368463 95.73914152281817 L 1873.153776883854 95.73914152281817 L 1873.153776883854 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1890.877472464354" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">SAP</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1954.2706456368462 51.63409261281818 L 2100.2691689999947 51.63409261281818 L 2100.2691689999947 95.73914152281817 L 1954.2706456368462 95.73914152281817 L 1954.2706456368462 51.63409261281818 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1971.9943412173461" y="79.40393822281817" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">WebhookService</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="880.9074401855469" y="24.651306798181814" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Happy Path – Partner Payment Flow</text></g><g><rect fill="white" stroke="none" x="69.25849635929559" y="128.4095481228182" width="310.8560663610937" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="71.70877685429559" y="143.1112310928182" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /v1/payments (Idempotency-Key + Auth)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 49.928505787628914 149.64531241281819 L 397.40266813834506 149.64531241281819" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(399.4445685508451,149.64531241281819) translate(-399.4445685508451,-149.64531241281819)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 385.449324167791 143.40191492719475 L 397.9142686852956 149.64531241281819 L 385.449324167791 155.88870989844162" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="418.77455912251173" y="174.1481173628182" width="251.800951615" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="421.22483961751175" y="188.84980033281818" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">validate auth, rate limit, mapping rules</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 399.4445685508451 195.3838816528182 L 687.8636008966783 195.3838816528182" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(689.9055013091784,195.3838816528182) translate(-689.9055013091784,-195.3838816528182)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 675.9102569261244 189.14048416719476 L 688.3752014436288 195.3838816528182 L 675.9102569261244 201.62727913844162" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="479.8947907509297" y="219.8866866028182" width="129.56048835816406" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="482.3450712459297" y="234.58836957281818" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">OK (partner config)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 689.9055013091784 241.1224508928182 L 401.4864689633451 241.1224508928182" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="6.53408132"/><g transform="translate(399.4445685508451,241.1224508928182) translate(-399.4445685508451,-241.1224508928182)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 413.43981293389913 234.87905340719476 L 400.97486841639454 241.1224508928182 L 413.43981293389913 247.36584837844163" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="467.254149306724" y="265.62525584281815" width="348.34352363648435" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="469.704429801724" y="280.3269388128181" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TX: insert payment + insert outbox(PaymentCreated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 399.4445685508451 286.86102013281817 L 881.3653532865873 286.86102013281817" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(883.4072536990873,286.86102013281817) translate(-883.4072536990873,-286.86102013281817)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 869.4120093160333 280.6176226471947 L 881.8769538335378 286.86102013281817 L 869.4120093160333 293.10441761844163" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="110.28208644718622" y="311.36382508281815" width="228.80890144410156" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="112.73236694218622" y="326.06550805281813" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">202 Accepted {status: "QUEUED"}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 399.4445685508451 332.5995893728182 L 51.97040620012891 332.5995893728182" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="6.53408132"/><g transform="translate(49.928505787628914,332.5995893728182) translate(-49.928505787628914,-332.5995893728182)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 63.92375017068295 326.3561918871947 L 51.458805653178395 332.5995893728182 L 63.92375017068295 338.84298685844163" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="902.7372442707539" y="357.10239432281816" width="199.65352119507813" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="905.1875247657539" y="371.80407729281814" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">poll outbox (PaymentCreated)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1121.7207560374986 378.3381586128182 L 885.4491541115873 378.3381586128182" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(883.4072536990873,378.3381586128182) translate(-883.4072536990873,-378.3381586128182)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 897.4024980821413 372.0947611271947 L 884.9375535646368 378.3381586128182 L 897.4024980821413 384.58155609844164" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1141.0507466091651" y="402.84096356281816" width="205.37292732300781" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1143.5010271041651" y="417.54264653281814" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">publish PaymentCreated event</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1121.7207560374986 424.0767278528182 L 1363.7117640913398 424.0767278528182" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(1365.7536645038397,424.0767278528182) translate(-1365.7536645038397,-424.0767278528182)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1351.7584201207856 417.8333303671947 L 1364.2233646382901 424.0767278528182 L 1351.7584201207856 430.32012533844164" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1385.0836550755064" y="448.57953280281816" width="162.1660639196875" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1387.5339355705064" y="463.28121577281814" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">deliver PaymentCreated</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1365.7536645038397 469.8152970928182 L 1564.5378091543605 469.8152970928182" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(1566.5797095668604,469.8152970928182) translate(-1566.5797095668604,-469.8152970928182)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1552.5844651838063 463.5718996071947 L 1565.0494097013109 469.8152970928182 L 1552.5844651838063 476.05869457844165" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1014.5539979166522" y="494.31810204281817" width="227.37721504273438" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.0042784116522" y="509.01978501281815" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">fetch mapping rules, webhook info</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1566.5797095668604 515.5538663328182 L 691.9474017216784 515.5538663328182" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(689.9055013091784,515.5538663328182) translate(-689.9055013091784,-515.5538663328182)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 703.9007456922324 509.3104688471947 L 691.4358011747279 515.5538663328182 L 703.9007456922324 521.7972638184416" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1585.9097001385271" y="540.0566712828181" width="300.3049189001562" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1588.3599806335271" y="554.7583542528181" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST payment (dedupe token = payment_id)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1566.5797095668604 561.2924355728181 L 1903.5027091978502 561.2924355728181" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(1905.54460961035,561.2924355728181) translate(-1905.54460961035,-561.2924355728181)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1891.549365227296 555.0490380871947 L 1904.0143097448006 561.2924355728181 L 1891.549365227296 567.5358330584415" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1708.7550446819841" y="585.7952405228181" width="54.61422981324219" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1711.2053251769842" y="600.496923492818" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1905.54460961035 607.0310048128181 L 1568.6216099793603 607.0310048128181" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="6.53408132"/><g transform="translate(1566.5797095668604,607.0310048128181) translate(-1566.5797095668604,-607.0310048128181)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1580.5749539499145 600.7876073271947 L 1568.11000943241 607.0310048128181 L 1580.5749539499145 613.2744022984415" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1034.3077580227393" y="631.533809762818" width="381.3714472204687" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1036.7580385177394" y="646.235492732818" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">update status=SETTLED + insert outbox(PaymentSettled)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1566.5797095668604 652.769574052818 L 885.4491541115873 652.769574052818" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(883.4072536990873,652.769574052818) translate(-883.4072536990873,-652.769574052818)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 897.4024980821413 646.5261765671946 L 884.9375535646368 652.769574052818 L 897.4024980821413 659.0129715384414" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="905.99422516675" y="677.272379002818" width="193.13955940308594" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="908.44450566175" y="691.9740619728179" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">poll outbox (PaymentSettled)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1121.7207560374986 698.508143292818 L 885.4491541115873 698.508143292818" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(883.4072536990873,698.508143292818) translate(-883.4072536990873,-698.508143292818)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 897.4024980821413 692.2647458071946 L 884.9375535646368 698.508143292818 L 897.4024980821413 704.7515407784414" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1144.3077275051612" y="723.0109482428179" width="198.85896553101563" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1146.7580080001612" y="737.7126312128179" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">publish PaymentSettled event</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1121.7207560374986 744.2467125328179 L 1363.7117640913398 744.2467125328179" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(1365.7536645038397,744.2467125328179) translate(-1365.7536645038397,-744.2467125328179)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1351.7584201207856 738.0033150471945 L 1364.2233646382901 744.2467125328179 L 1351.7584201207856 750.4901100184413" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1618.6857348472824" y="768.7495174828179" width="155.65210212769531" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1621.1360153422825" y="783.4512004528178" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">deliver PaymentSettled</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1365.7536645038397 789.9852817728179 L 2025.2280069059204 789.9852817728179" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(2027.2699073184203,789.9852817728179) translate(-2027.2699073184203,-789.9852817728179)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2013.2746629353662 783.7418842871945 L 2025.7396074528708 789.9852817728179 L 2013.2746629353662 796.2286792584413" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1247.1431840116704" y="814.4880867228178" width="222.88904060425781" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1249.5934645066704" y="829.1897696928178" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">fetch webhook URL + signing key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2027.2699073184203 835.7238510128178 L 691.9474017216784 835.7238510128178" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(689.9055013091784,835.7238510128178) translate(-689.9055013091784,-835.7238510128178)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 703.9007456922324 829.4804535271944 L 691.4358011747279 835.7238510128178 L 703.9007456922324 841.9672484984412" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="956.2956927206224" y="860.2266559628177" width="164.6070276648047" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="958.7459732156224" y="874.9283389328177" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST webhook (signed)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2027.2699073184203 881.4624202528178 L 51.97040620012891 881.4624202528178" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><g transform="translate(49.928505787628914,881.4624202528178) translate(-49.928505787628914,-881.4624202528178)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 63.92375017068295 875.2190227671944 L 51.458805653178395 881.4624202528178 L 63.92375017068295 887.7058177384412" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g><g><rect fill="white" stroke="none" x="1011.2920916464036" y="905.9652252028177" width="54.61422981324219" height="21.23576429"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1013.7423721414036" y="920.6669081728177" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">200 OK</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 49.928505787628914 927.2009894928177 L 2025.2280069059204 927.2009894928177" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="6.53408132"/><g transform="translate(2027.2699073184203,927.2009894928177) translate(-2027.2699073184203,-927.2009894928177)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 2013.2746629353662 920.9575920071943 L 2025.7396074528708 927.2009894928177 L 2013.2746629353662 933.4443869784411" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/></g></svg>